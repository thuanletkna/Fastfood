@model IEnumerable<KetnoiCSDL.EF.User>
@{
    ViewBag.Title = "XemThongTin";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@{
    var session =
   (BunyStore.Common.UserLogin)Session[BunyStore.Common.CommonConstants.USER_SESSION];
    var user = (KetnoiCSDL.EF.User)ViewBag.User;
}

@*@section css{
    <link href="/assets/client/css/Changepass_User.css" rel="stylesheet" />
}*@


    <!--contact area start-->
    <div class="wishlist_page_bg">
        <div class="container">
            <div class="wishlist_area">
                <div class="wishlist_inner">
                    <form action="#">
                        <div class="row">
                            <div class="col-12">
                                <div class="table_desc wishlist">
                                    <div class="cart_page table-responsive">
                                        <table>
                                            <thead>
                                                <tr>
                                                    <th class="product_remove">Họ và tên</th>
                                                    <th class="product_thumb">Số điện thoại</th>
                                                    <th class="product_name">Email</th>
                                                    <th class="product-price">Tên đăng nhập</th>

                                                    <th class="product_quantity">Địa chỉ</th>
                                                    <th class="product_total">Ngày tạo</th>
                                                    <th class="product_total">Sửa</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td class="product_remove">@session.Name</td>
                                                    <td class="product_thumb">@session.Phone</td>
                                                    <td class="product_name"><a href="#">@session.Email</a></td>
                                                    <td class="product_name"><a href="#">@session.UserName</a></td>

                                                    <td class="product_quantity">@session.Address  @session.PrecinctID  @session.DistrictID  @session.ProvinceID</td>
                                                    <td class="product_total">@session.CreatedDate</td>
                                                   
                                                        <td class="product_total"><a href="/EditUser/Edit/@session.UserID">Sửa</a></td>
                                                        
                                                    </tr>



                                            </tbody>
                                        </table>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </form>
                </div>


                <!--<div class="wishlist_area">
                    <div class="wishlist_inner">
                        <div class="inforow">
                            <hr style="margin:5px 0 5px 0;">
                            <div class="col-sm-5 col-xs-6 tital ">Tên đăng nhập:</div><div class="col-sm-7  ">@session.UserName</div>
                            <div class="bot-border"></div>
                        </div>
                        <div id="pwd" class="inforow" rel="display">
                            <div class="col-sm-5 col-xs-6 tital" style="margin-right:14px">
                                <label style="font-weight: normal ">Mật khẩu:   </label>
                            </div>
                            <div lass="col-sm-7 col-xs-6 ">
                                <p style="margin:0;padding:0" class="lk_update"><a id="doi_mk" href="javascript:void(0)">Đổi mật khẩu</a></p>
                                <div><span id="pass_display">@session.Password</span></div>
                            </div>
                        </div>

                        <div id="pwd_edit_form" rel="edit" style="position: relative; display: none;">
                            <div id="loading" style="display:none;z-index:1000;position: absolute;width: 100%;background-color: #ECECEC;height: 100%;opacity: 0.5;text-align: center;">
                                <img src="https://stc-id.zing.vn/login/images/loader.gif" style="height: 100px;padding-top:120px;">
                            </div>
                            <input type="hidden" name="tokenCaptcha" id="tokenCaptcha" value="29ddfc5206206d6b570e91e3ff50bd9c6ff477c666a321cffb399c36b63a947eb895e3567a29271e3c23d10cde7903a0d5c0d725e2e57e51d26bb28d0095b65eaf5e3a4b05366d81ba2f1c98bb32d89a">
                            <input type="hidden" name="pwd_tokenExpire" id="pwd_tokenExpire" value="PR7G8tPpvJnCrD2_XFFdPaQSzpDhLF07KSY3l0==">
                            <form id="frm_pwd">
                                <div class="subcont sub_chgpass" id="pwd_edit">
                                    <div class="inforow">
                                        <p style="    margin-left: 125px; margin-bottom: 25px; color: red;">Mật khẩu phải có từ 6-32 kí tự</p>
                                        <label>Mật khẩu:</label>
                                        <div class="infotext">
                                            <div class="rowcont">
                                                <p class="subcont_lb_gc">Mật khẩu hiện tại:</p>
                                                <div class="subcont_text_gc">
                                                    <input class="subform_input_gc" tabindex="1" type="password" maxlength="32" name="old_password" id="sOldPassword">
                                                    <span id="sOldPassword_icon" style="display: none">
                                                        <img src="https://stc-id.zing.vn/login/forgotinfo/images/checkbullet.gif" class="check_icon" alt="finish" style="display: none;">
                                                    </span>
                                                    <div class="clr"></div>
                                                    <span class="warning" rel="1" id="sOldPassword_err"></span>
                                                </div>
                                                <div class="clr"></div>
                                            </div>
                                            <div class="rowcont">
                                                <p class="subcont_lb_gc">Mật khẩu mới:</p>
                                                <div class="subcont_text_gc" style="position:relative;">
                                                    <input id="new_password" tabindex="2" name="new_password" type="password" maxlength="32" class="subform_input_gc" style="float: left">
                                                    <div class="stronglevel" style="float: left;display: block;font-size:12px">
                                                    </div>
                                                    <div class="clr"></div>
                                                    <div id="new_password_note" class="formtipbubble" style="display:none;top:35px;right:-15px">
                                                        <span class="formtip_arrow zidsprt"></span>
                                                        <div class="formtip_inner">
                                                            Mật khẩu phải có từ 6-32 ký tự.

                                                        </div>
                                                    </div>
                                                    <div class="clr"></div>
                                                    <span class="warning" rel="2" id="new_password_err"></span>
                                                </div>
                                                <div class="clr"></div>
                                            </div>
                                            <div class="rowcont">
                                                <p class="subcont_lb_gc">Xác nhận mật khẩu:</p>
                                                <div class="subcont_text_gc">
                                                    <input type="password" tabindex="3" maxlength="32" name="confirm_password" id="confirm_password" class="subform_input_gc">
                                                    <span id="confirm_password_icon" style=" display:none">
                                                        <img src="https://stc-id.zing.vn/login/forgotinfo/images/checkbullet.gif" class="check_icon" alt="finish" style="display: none;">
                                                    </span>
                                                    <div class="clr"></div>
                                                    <span class="warning" rel="3" id="confirm_password_err"></span>
                                                </div>
                                                <div class="clr"></div>
                                            </div>

                                            <span class="warning" rel="5" id="pwd_err">&nbsp;</span>
                                        </div>
                                    </div>
                                    <p class="subform_btn">-->

                                        @*//Quên mật khẩu*@
                                        <!--<a href="http://localhost:62443/quen-mat-khau" style="float: left;">Quên mật khẩu ?</a>
                                        <a href="javascript:void(0)" tabindex="5" id="check_pass" class="sfbtn_submit">Cập nhật</a>
                                        <a href="javascript:void(0)" id="cancel_edit" class="sfbtn_cancel">Bỏ qua</a>
                                    </p>
                                </div>
                            </form>
                        </div>

                        <div class="inforow">
                            <div class="col-sm-5 col-xs-6 tital ">Email:</div><div class="col-sm-7"> @session.Email</div>
                            <div class="bot-border"></div>
                        </div>
                    </div>
                </div>-->
                <!-- /.box-body -->
                <!-- /.box -->
                <!--<div class="row">
        <div class="col-12">
            <div class="wishlist_share">
                <h4>Share on:</h4>
                <ul>
                    <li><a href="#"><i class="fa fa-rss"></i></a></li>
                    <li><a href="#"><i class="fa fa-vimeo"></i></a></li>
                    <li><a href="#"><i class="fa fa-tumblr"></i></a></li>
                    <li><a href="#"><i class="fa fa-pinterest"></i></a></li>
                    <li><a href="#"><i class="fa fa-linkedin"></i></a></li>
                </ul>
            </div>
        </div>
    </div>-->
            </div>
        </div>
    </div>


    <script>

        function md5cycle(x, k) {
            var a = x[0], b = x[1], c = x[2], d = x[3];

            a = ff(a, b, c, d, k[0], 7, -680876936);
            d = ff(d, a, b, c, k[1], 12, -389564586);
            c = ff(c, d, a, b, k[2], 17, 606105819);
            b = ff(b, c, d, a, k[3], 22, -1044525330);
            a = ff(a, b, c, d, k[4], 7, -176418897);
            d = ff(d, a, b, c, k[5], 12, 1200080426);
            c = ff(c, d, a, b, k[6], 17, -1473231341);
            b = ff(b, c, d, a, k[7], 22, -45705983);
            a = ff(a, b, c, d, k[8], 7, 1770035416);
            d = ff(d, a, b, c, k[9], 12, -1958414417);
            c = ff(c, d, a, b, k[10], 17, -42063);
            b = ff(b, c, d, a, k[11], 22, -1990404162);
            a = ff(a, b, c, d, k[12], 7, 1804603682);
            d = ff(d, a, b, c, k[13], 12, -40341101);
            c = ff(c, d, a, b, k[14], 17, -1502002290);
            b = ff(b, c, d, a, k[15], 22, 1236535329);

            a = gg(a, b, c, d, k[1], 5, -165796510);
            d = gg(d, a, b, c, k[6], 9, -1069501632);
            c = gg(c, d, a, b, k[11], 14, 643717713);
            b = gg(b, c, d, a, k[0], 20, -373897302);
            a = gg(a, b, c, d, k[5], 5, -701558691);
            d = gg(d, a, b, c, k[10], 9, 38016083);
            c = gg(c, d, a, b, k[15], 14, -660478335);
            b = gg(b, c, d, a, k[4], 20, -405537848);
            a = gg(a, b, c, d, k[9], 5, 568446438);
            d = gg(d, a, b, c, k[14], 9, -1019803690);
            c = gg(c, d, a, b, k[3], 14, -187363961);
            b = gg(b, c, d, a, k[8], 20, 1163531501);
            a = gg(a, b, c, d, k[13], 5, -1444681467);
            d = gg(d, a, b, c, k[2], 9, -51403784);
            c = gg(c, d, a, b, k[7], 14, 1735328473);
            b = gg(b, c, d, a, k[12], 20, -1926607734);

            a = hh(a, b, c, d, k[5], 4, -378558);
            d = hh(d, a, b, c, k[8], 11, -2022574463);
            c = hh(c, d, a, b, k[11], 16, 1839030562);
            b = hh(b, c, d, a, k[14], 23, -35309556);
            a = hh(a, b, c, d, k[1], 4, -1530992060);
            d = hh(d, a, b, c, k[4], 11, 1272893353);
            c = hh(c, d, a, b, k[7], 16, -155497632);
            b = hh(b, c, d, a, k[10], 23, -1094730640);
            a = hh(a, b, c, d, k[13], 4, 681279174);
            d = hh(d, a, b, c, k[0], 11, -358537222);
            c = hh(c, d, a, b, k[3], 16, -722521979);
            b = hh(b, c, d, a, k[6], 23, 76029189);
            a = hh(a, b, c, d, k[9], 4, -640364487);
            d = hh(d, a, b, c, k[12], 11, -421815835);
            c = hh(c, d, a, b, k[15], 16, 530742520);
            b = hh(b, c, d, a, k[2], 23, -995338651);

            a = ii(a, b, c, d, k[0], 6, -198630844);
            d = ii(d, a, b, c, k[7], 10, 1126891415);
            c = ii(c, d, a, b, k[14], 15, -1416354905);
            b = ii(b, c, d, a, k[5], 21, -57434055);
            a = ii(a, b, c, d, k[12], 6, 1700485571);
            d = ii(d, a, b, c, k[3], 10, -1894986606);
            c = ii(c, d, a, b, k[10], 15, -1051523);
            b = ii(b, c, d, a, k[1], 21, -2054922799);
            a = ii(a, b, c, d, k[8], 6, 1873313359);
            d = ii(d, a, b, c, k[15], 10, -30611744);
            c = ii(c, d, a, b, k[6], 15, -1560198380);
            b = ii(b, c, d, a, k[13], 21, 1309151649);
            a = ii(a, b, c, d, k[4], 6, -145523070);
            d = ii(d, a, b, c, k[11], 10, -1120210379);
            c = ii(c, d, a, b, k[2], 15, 718787259);
            b = ii(b, c, d, a, k[9], 21, -343485551);

            x[0] = add32(a, x[0]);
            x[1] = add32(b, x[1]);
            x[2] = add32(c, x[2]);
            x[3] = add32(d, x[3]);

        }

        function cmn(q, a, b, x, s, t) {
            a = add32(add32(a, q), add32(x, t));
            return add32((a << s) | (a >>> (32 - s)), b);
        }

        function ff(a, b, c, d, x, s, t) {
            return cmn((b & c) | ((~b) & d), a, b, x, s, t);
        }

        function gg(a, b, c, d, x, s, t) {
            return cmn((b & d) | (c & (~d)), a, b, x, s, t);
        }

        function hh(a, b, c, d, x, s, t) {
            return cmn(b ^ c ^ d, a, b, x, s, t);
        }

        function ii(a, b, c, d, x, s, t) {
            return cmn(c ^ (b | (~d)), a, b, x, s, t);
        }

        function md51(s) {
            txt = '';
            var n = s.length,
                state = [1732584193, -271733879, -1732584194, 271733878], i;
            for (i = 64; i <= s.length; i += 64) {
                md5cycle(state, md5blk(s.substring(i - 64, i)));
            }
            s = s.substring(i - 64);
            var tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
            for (i = 0; i < s.length; i++)
                tail[i >> 2] |= s.charCodeAt(i) << ((i % 4) << 3);
            tail[i >> 2] |= 0x80 << ((i % 4) << 3);
            if (i > 55) {
                md5cycle(state, tail);
                for (i = 0; i < 16; i++) tail[i] = 0;
            }
            tail[14] = n * 8;
            md5cycle(state, tail);
            return state;
        }

        function md5blk(s) { /* I figured global was faster.   */
            var md5blks = [], i; /* Andy King said do it this way. */
            for (i = 0; i < 64; i += 4) {
                md5blks[i >> 2] = s.charCodeAt(i)
                    + (s.charCodeAt(i + 1) << 8)
                    + (s.charCodeAt(i + 2) << 16)
                    + (s.charCodeAt(i + 3) << 24);
            }
            return md5blks;
        }

        var hex_chr = '0123456789abcdef'.split('');

        function rhex(n) {
            var s = '', j = 0;
            for (; j < 4; j++)
                s += hex_chr[(n >> (j * 8 + 4)) & 0x0F]
                    + hex_chr[(n >> (j * 8)) & 0x0F];
            return s;
        }

        function hex(x) {
            for (var i = 0; i < x.length; i++)
                x[i] = rhex(x[i]);
            return x.join('');
        }

        function md5(s) {
            return hex(md51(s));
        }

        function add32(a, b) {
            return (a + b) & 0xFFFFFFFF;
        }

        if (md5('hello') != '5d41402abc4b2a76b9719d911017c592') {
            function add32(x, y) {
                var lsw = (x & 0xFFFF) + (y & 0xFFFF),
                    msw = (x >> 16) + (y >> 16) + (lsw >> 16);
                return (msw << 16) | (lsw & 0xFFFF);
            }
        }





        var temp = $("#pass_display").text()
        var id = $("#id").text()

        $(document).ready()
        {
            $("#pass_display").text("********");

        }


        $("#doi_mk").click(function () {
            $("#pwd").hide()
            $("#pwd_edit_form").show()

        });

        $("#cancel_edit").click(function () {
            $("#pwd_edit_form").hide()
            $("#pwd").show()
            $("#sOldPassword_err").text("")
            $("#new_password_err").text("")
            $("#confirm_password_err").text("")
        });

        $("#check_pass").click(function () {
            var pass = $("#sOldPassword").val();
            var new_pass = $("#new_password").val()
            var confirm_pass = $("#confirm_password").val()
            if (pass == "") {
                $("#sOldPassword_err").text("Bạn cần nhập thông tin này")
            }
            else {
                $("#sOldPassword_err").text("")
            }

            if (new_pass == "") {
                $("#new_password_err").text("Bạn cần nhập thông tin này")
            }
            else {
                $("#new_password_err").text("")
            }
            if (confirm_pass == "") {
                $("#confirm_password_err").text("Bạn cần nhập thông tin này")
            }
            else {
                $("#confirm_password_err").text("")
            }
            if (pass != "" && new_pass != "" && confirm_pass != "") {
                if (md5(pass) == temp.toLowerCase()) {
                    if (new_pass == confirm_pass) {
                        var pass_new = md5(confirm_pass)
                        //$("#sOldPassword").val("");
                        //$("#new_password").val("");
                        //$("#confirm_password").val("");
                        //$("#pwd_edit_form").hide()
                        //$("#pwd").show()
                        alert("Cập nhật mật khẩu thành công")

                        model = { id: id, pass: pass_new }
                        $.ajax({
                            url: "/User/XuLyMatKhau",
                            type: 'POST',
                            data: model,
                            dataType: "jsonp",
                        });

                        window.location.reload()
                    }
                    else {
                        alert("mk moi va xac nhan khong dung")
                    }
                }
                else {
                    $("#sOldPassword").val("");
                    $("#new_password").val("");
                    $("#confirm_password").val("");
                    alert("Sai mật khẩu")
                }
            }
        });
    </script>








